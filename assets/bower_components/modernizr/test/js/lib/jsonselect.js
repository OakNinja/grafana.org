/*! Copyright (c) 2011, Lloyd Hilaiel, ISC License */
!function(t){function e(t){try{return JSON&&JSON.parse?JSON.parse(t):new Function("return "+t)()}catch(e){i("ijs")}}function i(t){throw new Error(d[t])}function n(t){return Array.isArray?Array.isArray(t):"[object Array]"===c.call(t)}function s(t){if(null===t)return"null";var e=typeof t;return"object"===e&&n(t)&&(e="array"),e}function a(t,e,i,n,a){var o,r=[],l=">"===e[0]?e[1]:e[0],c=!0;return l.type&&(c=c&&l.type===s(t)),l.id&&(c=c&&l.id===i),c&&l.pf&&(":nth-last-child"===l.pf?n=a-n:n++,0===l.a?c=l.b===n:(o=(n-l.b)%l.a,c=!o&&n*l.a+l.b>=0)),">"!==e[0]&&":root"!==e[0].pc&&r.push(e),c&&(">"===e[0]?e.length>2&&(c=!1,r.push(e.slice(2))):e.length>1&&(c=!1,r.push(e.slice(1)))),[c,r]}function o(t,e,i,s,r,l){var c,d,u=","===t[0]?t.slice(1):[t],h=[],f=!1,p=0,g=0,m=0;for(p=0;p<u.length;p++)for(d=a(e,u[p],s,r,l),d[0]&&(f=!0),g=0;g<d[1].length;g++)h.push(d[1][g]);if(h.length&&"object"==typeof e)if(h.length>=1&&h.unshift(","),n(e))for(p=0;p<e.length;p++)o(h,e[p],i,void 0,p,e.length);else{m=0;for(c in e)e.hasOwnProperty(c)&&m++;p=0;for(c in e)e.hasOwnProperty(c)&&o(h,e[c],i,c,p++,m)}f&&i&&i(e)}function r(t,e){var i=[];return o(t,e,function(t){i.push(t)}),i}function l(t){return{sel:g(t),match:function(t){return r(this.sel,t)},forEach:function(t,e){return o(this.sel,t,e)}}}var c=Object.prototype.toString,d={ijs:"invalid json string",mpc:"multiple pseudo classes (:xxx) not allowed",mepf:"malformed expression in pseudo-function",nmi:"multiple ids not allowed",se:"selector expected",sra:"string required after '.'",uc:"unrecognized char",ujs:"unclosed json string",upc:"unrecognized pseudo class"},u={psc:1,psf:2,typ:3,str:4},h=/^(?:([\r\n\t\ ]+)|([*.,>])|(string|boolean|null|array|object|number)|(:(?:root|first-child|last-child|only-child))|(:(?:nth-child|nth-last-child))|(:\w+)|(\"(?:[^\\]|\\[^\"])*\")|(\")|((?:[_a-zA-Z]|[^\0-\0177]|\\[^\r\n\f0-9a-fA-F])(?:[_a-zA-Z0-9\-]|[^\u0000-\u0177]|(?:\\[^\r\n\f0-9a-fA-F]))*))/,f=/^\s*\(\s*(?:([+\-]?)([0-9]*)n\s*(?:([+\-])\s*([0-9]))?|(odd|even)|([+\-]?[0-9]+))\s*\)/,p=function(t,n){n||(n=0);var s=h.exec(t.substr(n));if(!s)return void 0;n+=s[0].length;var a;return s[1]?a=[n," "]:s[2]?a=[n,s[0]]:s[3]?a=[n,u.typ,s[0]]:s[4]?a=[n,u.psc,s[0]]:s[5]?a=[n,u.psf,s[0]]:s[6]?i("upc"):s[7]?a=[n,u.str,e(s[0])]:s[8]?i("ujs"):s[9]&&(a=[n,u.str,s[0].replace(/\\([^\r\n\f0-9a-fA-F])/g,"$1")]),a},g=function(t){for(var e,i=[],n=0;;){var s=m(t,n);if(i.push(s[1]),s=p(t,n=s[0]),s&&" "===s[1]&&(s=p(t,n=s[0])),!s)break;">"===s[1]?(i.push(">"),n=s[0]):","===s[1]&&(void 0===e?e=[",",i]:e.push(i),i=[],n=s[0])}return e&&e.push(i),e?e:i},m=function(t,e){var n=e,s={},a=p(t,e);for(a&&" "===a[1]&&(n=e=a[0],a=p(t,e)),a&&a[1]===u.typ?(s.type=a[2],a=p(t,e=a[0])):a&&"*"===a[1]&&(a=p(t,e=a[0]));;){if(void 0===a)break;if("."===a[1])a=p(t,e=a[0]),a&&a[1]===u.str||i("sra"),s.id&&i("nmi"),s.id=a[2];else if(a[1]===u.psc)(s.pc||s.pf)&&i("mpc"),":first-child"===a[2]?(s.pf=":nth-child",s.a=0,s.b=1):":last-child"===a[2]?(s.pf=":nth-last-child",s.a=0,s.b=1):s.pc=a[2];else{if(a[1]!==u.psf)break;(s.pc||s.pf)&&i("mpc"),s.pf=a[2];var o=f.exec(t.substr(a[0]));o||i("mepf"),o[5]?(s.a=2,s.b="odd"===o[5]?1:0):o[6]?(s.a=0,s.b=parseInt(o[6],10)):(s.a=parseInt((o[1]?o[1]:"+")+(o[2]?o[2]:"1"),10),s.b=o[3]?parseInt(o[3]+o[4],10):0),a[0]+=o[0].length}a=p(t,e=a[0])}return n===e&&i("se"),[e,s]};t._lex=p,t._parse=g,t.match=function(t,e){return l(t).match(e)},t.forEach=function(t,e,i){return l(t).forEach(e,i)},t.compile=l}("undefined"==typeof exports?window.JSONSelect={}:exports);