define(["./core","./data/var/data_priv","./deferred","./callbacks"],function(e,t){return e.extend({queue:function(n,r,o){var s;return n?(r=(r||"fx")+"queue",s=t.get(n,r),o&&(!s||e.isArray(o)?s=t.access(n,r,e.makeArray(o)):s.push(o)),s||[]):void 0},dequeue:function(t,n){n=n||"fx";var r=e.queue(t,n),o=r.length,s=r.shift(),i=e._queueHooks(t,n),a=function(){e.dequeue(t,n)};"inprogress"===s&&(s=r.shift(),o--),s&&("fx"===n&&r.unshift("inprogress"),delete i.stop,s.call(t,a,i)),!o&&i&&i.empty.fire()},_queueHooks:function(n,r){var o=r+"queueHooks";return t.get(n,o)||t.access(n,o,{empty:e.Callbacks("once memory").add(function(){t.remove(n,[r+"queue",o])})})}}),e.fn.extend({queue:function(t,n){var r=2;return"string"!=typeof t&&(n=t,t="fx",r--),arguments.length<r?e.queue(this[0],t):void 0===n?this:this.each(function(){var r=e.queue(this,t,n);e._queueHooks(this,t),"fx"===t&&"inprogress"!==r[0]&&e.dequeue(this,t)})},dequeue:function(t){return this.each(function(){e.dequeue(this,t)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(n,r){var o,s=1,i=e.Deferred(),a=this,u=this.length,c=function(){--s||i.resolveWith(a,[a])};for("string"!=typeof n&&(r=n,n=void 0),n=n||"fx";u--;)o=t.get(a[u],n+"queueHooks"),o&&o.empty&&(s++,o.empty.add(c));return c(),i.promise(r)}}),e});