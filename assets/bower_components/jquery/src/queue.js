define(["./core","./data/var/data_priv","./deferred","./callbacks"],function(e,n){return e.extend({queue:function(t,r,o){var i;return t?(r=(r||"fx")+"queue",i=n.get(t,r),o&&(!i||e.isArray(o)?i=n.access(t,r,e.makeArray(o)):i.push(o)),i||[]):void 0},dequeue:function(n,t){t=t||"fx";var r=e.queue(n,t),o=r.length,i=r.shift(),u=e._queueHooks(n,t),s=function(){e.dequeue(n,t)};"inprogress"===i&&(i=r.shift(),o--),i&&("fx"===t&&r.unshift("inprogress"),delete u.stop,i.call(n,s,u)),!o&&u&&u.empty.fire()},_queueHooks:function(t,r){var o=r+"queueHooks";return n.get(t,o)||n.access(t,o,{empty:e.Callbacks("once memory").add(function(){n.remove(t,[r+"queue",o])})})}}),e.fn.extend({queue:function(n,t){var r=2;return"string"!=typeof n&&(t=n,n="fx",r--),arguments.length<r?e.queue(this[0],n):void 0===t?this:this.each(function(){var r=e.queue(this,n,t);e._queueHooks(this,n),"fx"===n&&"inprogress"!==r[0]&&e.dequeue(this,n)})},dequeue:function(n){return this.each(function(){e.dequeue(this,n)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(t,r){var o,i=1,u=e.Deferred(),s=this,c=this.length,f=function(){--i||u.resolveWith(s,[s])};for("string"!=typeof t&&(r=t,t=void 0),t=t||"fx";c--;)o=n.get(s[c],t+"queueHooks"),o&&o.empty&&(i++,o.empty.add(f));return f(),u.promise(r)}}),e});