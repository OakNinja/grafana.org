define(["./core","./data/var/data_priv","./deferred","./callbacks"],function(e,t){return e.extend({queue:function(s,n,i){var r;return s?(n=(n||"fx")+"queue",r=t.get(s,n),i&&(!r||e.isArray(i)?r=t.access(s,n,e.makeArray(i)):r.push(i)),r||[]):void 0},dequeue:function(t,s){s=s||"fx";var n=e.queue(t,s),i=n.length,r=n.shift(),a=e._queueHooks(t,s),o=function(){e.dequeue(t,s)};"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===s&&n.unshift("inprogress"),delete a.stop,r.call(t,o,a)),!i&&a&&a.empty.fire()},_queueHooks:function(s,n){var i=n+"queueHooks";return t.get(s,i)||t.access(s,i,{empty:e.Callbacks("once memory").add(function(){t.remove(s,[n+"queue",i])})})}}),e.fn.extend({queue:function(t,s){var n=2;return"string"!=typeof t&&(s=t,t="fx",n--),arguments.length<n?e.queue(this[0],t):void 0===s?this:this.each(function(){var n=e.queue(this,t,s);e._queueHooks(this,t),"fx"===t&&"inprogress"!==n[0]&&e.dequeue(this,t)})},dequeue:function(t){return this.each(function(){e.dequeue(this,t)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(s,n){var i,r=1,a=e.Deferred(),o=this,u=this.length,c=function(){--r||a.resolveWith(o,[o])};for("string"!=typeof s&&(n=s,s=void 0),s=s||"fx";u--;)i=t.get(o[u],s+"queueHooks"),i&&i.empty&&(r++,i.empty.add(c));return c(),a.promise(n)}}),e});