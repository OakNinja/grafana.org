define(["../core","./var/nonce","./var/rquery","../ajax"],function(e,t,n){var r=[],o=/(=)\?(?=&|$)|\?\?/;e.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=r.pop()||e.expando+"_"+t++;return this[n]=!0,n}}),e.ajaxPrefilter("json jsonp",function(t,i,a){var s,c,d,u=t.jsonp!==!1&&(o.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&o.test(t.data)&&"data");return u||"jsonp"===t.dataTypes[0]?(s=t.jsonpCallback=e.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u?t[u]=t[u].replace(o,"$1"+s):t.jsonp!==!1&&(t.url+=(n.test(t.url)?"&":"?")+t.jsonp+"="+s),t.converters["script json"]=function(){return d||e.error(s+" was not called"),d[0]},t.dataTypes[0]="json",c=window[s],window[s]=function(){d=arguments},a.always(function(){window[s]=c,t[s]&&(t.jsonpCallback=i.jsonpCallback,r.push(s)),d&&e.isFunction(c)&&c(d[0]),d=c=void 0}),"script"):void 0})});